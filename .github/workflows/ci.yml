name: Test Reusable WorkFlow user

on:
  workflow_dispatch:
  push:
    branches:
      - 'feature/*'
      - '!master'
      - '!main'
  pull_request:
    types:
      - 'closed'
  release:
    types:
      - 'published'

env:
  # You can use repository name or change the name
  # For example: 
  # change REPO_NAME: ${{ github.event.repository.name }} for REPO_NAME: "abc" 
  REPOSITORY_NAME: ${{ github.event.repository.name }}
  # TAG: ${{ github.event.release.tag_name }}
  # BASE_BRANCH: ${GITHUB_REF#refs/*/}

jobs:
  EnvSetup:
    name: Setup Dynamic Environment Variables
    runs-on: ubuntu-latest
    outputs:
      build-and-verify: ${{ steps.set-output-defaults.outputs.build-and-verify }}
    steps:
      - name: set outputs with default values
        id: set-output-defaults
        run: |    
          # If workflow_dispatch, use inputs (left), if other trigger, use default env (right)
          echo "::set-output name=build-and-verify::${{ github.event.repository.name }}"

  build:
    needs: [EnvSetup]
    uses: gudiaolabs/docker-build/.github/workflows/dockerbuild.yml@main
    with:
      image_name: ${{ needs.EnvSetup.outputs.build-and-verify }}

  # build-ecr:
  #   if: github.event_name == 'release' && github.event.action == 'published'
  #   uses: gudiaolabs/docker-build-push-ecr/.github/workflows/dockerbuildpushecr.yml@main
  #   with:
  #     ecr_repository: $REPO_NAME
  #     image_tag: 'v0.0.1'
  #   secrets: 
  #     aws_access_key_id: ${{ secrets.AWS_ACCESS_KEY_ID }}
  #     aws_secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

  # slack:
  #   if: github.event_name == 'release' && github.event.action == 'published'  
  #   uses: gudiaolabs/slack-notify/.github/workflows/slack-notify.yml@main
  #   secrets: 
  #     slack_webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}







